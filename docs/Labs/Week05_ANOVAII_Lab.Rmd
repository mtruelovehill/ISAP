---
title: "Week 6 Lab: ANOVA II"
output:
  learnr::tutorial:
    progressive: true
    allow_skip: true
    css: https://mtruelovehill.github.io/ISAP/Labs/css/style.css
runtime: shiny_prerendered
---


```{r setup, include=FALSE}
library(learnr)

pacman::p_load('tidyverse', 'kableExtra', 'shiny')

baseColor <- '#F28157'
accent1 <- '#F2B66D'
accent3 <- '#30726E'
accent4 <- '#008290'
```

## Intro to Today's Lab

During today's lab, you'll apply the concepts discussed during this week's lecture. Each lab consists of a range of tasks, with corresponding questions you can answer. Please note that the questions are not required and not marked, although they do provide a helpful source of formative feedback that will help you gauge your understanding. 

### Learning Objectives
At the end of this lab, you will be able to:

1. Identify hypotheses which may be tested using Factorial ANOVA
2. Check assumptions for a Factorial ANOVA
3. Use SPSS to perform Factorial ANOVAs
4. Run a power analysis for a Factorial ANOVA
5. Interpret and report results from Factorial ANOVAs



### This Week's Study
In this week's lab, you'll be working with data simulated based on [this paper](https://www.tandfonline.com/doi/abs/10.1207/S15326888CHC3104_5). In this study, researchers tested the effectiveness of two types of therapy (play therapy and pet therapy) on improving mood in hospitalised children.


## Overview

In this experiment, you'll be testing the effectiveness of two types of therapy to improve mood using a sample of hospitalised children. Participants were randomly assigned to one of three therapy groups (pet therapy, play therapy, or waitlist). Mood was assessed through the Reynolds Child Depression Scale and measured both before and after treatment. In order to determine the effectiveness of the treatment, the following three effects must be tested:

**Main Effect 1:** Is there a significant difference in RCDS scores of hospitalised children between the play therapy, pet therapy, and waitlist groups?

**Main Effect 2:** Is there a significant difference in RCDS scores of hospitalised children between baseline and follow-up sessions?

**Interaction Effect:** Does the effect of time on RCDS scores of hospitalised children change depending upon treatment group?


You can download the data for this week's lab [here.](https://mtruelovehill.github.io/ISAP/Labs/Week5LabData.sav)

This dataset contains the following variables:

```{r, echo = F}
dat <- read.csv('https://mtruelovehill.github.io/ISAP/Labs/Week5LabData.csv')
datInfo <- data.frame(VariableName=colnames(dat), 
                      Description=c('ID', 'Age in years', 'Gender', 'Levels: 0 = Waitlist; 1 = Play Therapy, 2 = Pet Therapy', 'pre-treatment RCDS score (possible values = 30-121)', 'post-treatment RCDS score (possible values = 30-121)'))

datInfo %>%
  kbl(col.names=c('Variable Name', 'Description')) %>%
  kable_styling(full_width = F) %>%
  row_spec(0, bold = T, color=baseColor, font_size = 18, align='l') %>%
  column_spec(1, bold = T, width = '4.5cm')
```


```{r tyo1, echo = FALSE}
quiz(caption = '',
     question('What is the proper way to describe the test that you will be performing?',
              answer('2x3 Between-Subjects One-Way ANOVA'),
              answer('2x3 Between-Subjects Factorial ANOVA'),
              answer('2x3 Repeated-Measures One-Way ANOVA'),
              answer('2x3 Repeated-Measures Factorial ANOVA'),
              answer('2x3 Mixed One-Way ANOVA'),
              answer('2x3 Mixed Factorial ANOVA', correct = T),
              message = 'You are running an ANOVA with an IV with 2 levels and an IV with 3 levels, so you should specify this as 2x3. You have both between- (condition) and within- (time) subjects variables, so it is a mixed ANOVA. You have more than 1 IV, so it is considered a Factorial ANOVA. You should specify all of these things when you refer to this test.'),
     question("What kind of variable is Condition?",
              answer("Between-Subjects", correct = T),
              answer("Within-Subjects"),
              message = 'Condition is a between-subjects variable, because each individual is only placed in one group. There is no sample overlap between the Waitlist and Therapy groups.'),
     question("What kind of variable is Time?",
              answer("Between-Subjects"),
              answer("Within-Subjects", correct = T),
              message = 'Time is a within-subjects variable, because all participants provided data at both Time 1 and Time 2.'))
```

### Your Tasks
+ [ ] $\ $ Identify your independent and dependent variables for this experiment. 
+ [ ] $\ $ State your hypotheses for this experiment, both using words and statistically.

Note that the research questions have already been specified, above.
<br>

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

To state hypotheses statistically, you should structure them in the framework of the statistical values being tested.

</details>
</div>
</br>

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

<b>Independent Variables:</b> Time (2 levels: Time 1/Time 2); Treatment Group (3 levels: Waitlist/Play Therapy/Pet Therapy)

<b>Dependent Variable:</b> RCDS scores

<br>

<b>Hypotheses:</b>

<i> General: </i>

**Main Effect 1**

$H_0:$ There will be no effect of Condition on RCDS Scores

$H_1:$ There will be an effect of Condition on RCDS Scores

**Main Effect 2**

$H_0:$ There will be no effect of Time on RCDS Scores

$H_1:$ There will be an effect of Time on RCDS Scores

**Interaction**

$H_0:$ The effect of Time on RCDS scores will not depend upon Condition.

$H_1:$ The effect of Time on RCDS scores is dependent upon Condition.


<i> Statistical: </i>

**Main Effect 1**

$H_0: \mu_{waitlist} = \mu_{PlayTherapy} = \mu_{PetTherapy}$

$H_1: \mu_{waitlist} \neq \mu_{PlayTherapy} \neq \mu_{PetTherapy}$

**Main Effect 2**

$H_0: \mu_{T1} = \mu_{T2}$

$H_1: \mu_{T1} \neq \mu_{T2}$

**Interaction Effect**

$C = (\mu_{T1}\times\mu_{waitlist}-\mu_{T1}\times\mu_{PlayTherapy}-\mu_{T1}\times\mu_{PetTherapy} )-(\mu_{T2}\times\mu_{waitlist}-\mu_{T2}\times\mu_{PlayTherapy}-\mu_{T2}\times\mu_{PetTherapy})$

$H_0: C = 0$

$H_1: C \neq 0$

</details>
</div>
</br>

## Power Analysis
<br>

Recall the effect size measure for ANOVA, $\eta^2$:

```{r, echo = F}

eta2Tab <- data.frame(Strength = c('Weak', 'Moderate', 'Strong'), Magnitude = c(.01, .06, .14))

eta2Tab %>%
  kbl(col.names=c('Variable Name', paste('Magnitude of', "$\\eta^2$"))) %>%
  kable_styling(full_width = F) %>%
  row_spec(0, bold = T, color=baseColor, font_size = 16, align='l') %>%
  column_spec(1, bold = T, width = '4.5cm')
```

### Your Task

+ [ ] $\ $ Run an a priori power analysis using $\alpha$ = .05 and power = .8 to determine the sample size necessary to detect a moderate ( $\eta^2$ = .06) interaction effect between `Condition` and `Time` on RCDS score. 

Please hit continue to view bonus tasks and solutions

### Bonus Tasks

+ [ ] $\ $ Run an a priori power analysis using $\alpha$ = .05 and power = .8 to determine the sample size necessary to detect a moderate ( $\eta^2$ = .06) main effect of `Time`. 

+ [ ] $\ $ Run an a priori power analysis using $\alpha$ = .05 and power = .8 to determine the effect size you're able to detect with a sample size of 150 for the main effect of `Condition`. 


There are many possible measures of effect size that are used across statistical tests. The software that we use to run power analyses, WebPower, uses $f$ as its measure of effect size for ANOVA. SPSS uses $\eta^2$, so we need to convert $\eta^2$ to $f$ before running the power analysis. You can do this with the following equation:

$$f = \sqrt{\frac{\eta^2}{1-\eta^2}}$$

You can convert $f$ to $\eta^2$ with this equation:

$$\eta^2 = \frac{f^2}{1+f^2}$$

Be sure to use $f$ when entering the effect size into WebPower and $\eta^2$ when interpreting your results. 

**VERY IMPORTANT NOTE:** $f$ is NOT the same as the $F$-statistic we compute when running an ANOVA. These are different values entirely. Bonkers, I know. Statisticians aren't the most creative namers.

Click [here to use WebPower to run your analysis](https://webpower.psychstat.org/wiki/models/index).

```{r cyrPower, echo = FALSE}
quiz(caption = 'Check Your Results',
     question_numeric("What is the number of measurements per group in your data? ",
              answer(2, correct = T),
              message = "The number of measurements in your data is 2. See the solution tab for more details."),
     question_numeric("How many participants do you need to detect a moderate interaction effect with 80% power and alpha = .05?",
              answer(158, correct = T),
              message = "You would need 158 total participants to detect the interaction effect, given the above constraints."),
     question_numeric("What is the minimum effect (eta-squared) of Condition you can detect with 150 participants, 80% power and alpha = .05?",
              answer(.06, correct = T),
              message = "You can detect a moderate effect (eta-squared = .06) with 150 participants under these constraints. An eta-squared of .06 is equivalent to f = .26."))
```

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>
<br>


If you're completely lost, you might find the help section on [WebPower ](https://webpower.psychstat.org/wiki/manual/power_of_RManova) useful.

</details>
</div>
</br>

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>
<br>


<span style = "font-weight: bold; font-size: 14pt"> Interaction Effect </span>

Navigate to the WebPower site and click Repeated-measures ANOVA:

```{r, echo = F, fig.align='center', out.width='75%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_powerOptions.png')
```
<br>
<i> Number of groups </i> refers to the number of independent groups you're comparing. In this case, you have 3 independent groups (the levels of your `Condition` variable). The 2 `Time` variable levels do not reflect independent groups (they are within-subjects/paired data). Note that if you had two between-subjects variables, you could compute this by multiplying the total number of levels within each independent variable. 

<i> Number of measurements </i> refers to the number of levels in your within-subjects variable. In this case, you have data at 2 timepoints. 



You'll leave the *Sample Size* option blank, as that's the value you want to calculate. 

To compute the *effect size*, $f$, you'll do the following:

$$f = \sqrt{\frac{.06}{1-.06}} = .25$$
As you don't anticipate any violations of sphericity (you only have 2 levels of your repeated-measures variable), you can leave the nonsphericity correction as is.

You can enter in the appropriate values for $\alpha$ and power. Because you're computing the power of your interaction effect, make sure that the type of effect is set properly. When you're finished, click 'Calculate' and you should see the following results if you've entered everything properly:

```{r, echo = F, fig.align='center', out.width='75%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_interactionPower.png')
```

To detect an interaction effect with the given constraints, you need 158 participants.

<br>

<span style = "font-weight: bold; font-size: 14pt"> Main Effect of `Time` </span>

To compute the power for the main effect of `Time`, leave all parameters the same, but change the 'Type of Effect' to 'within effect'.

```{r, echo = F, fig.align='center', out.width='75%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_me1Power.png')
```

To detect the main effect of `Time` with the given constraints, you need 128 participants.

<br>

<span style = "font-weight: bold; font-size: 14pt"> Main Effect of `Condition` </span>

To compute the effect size you have the power to detect for the main effect of `Condition` under the given constraints, leave the effect size parameter blank, set sample size to 150, and change the 'Type of Effect' to 'between effect'. Leave all other parameters unchanged:

```{r, echo = F, fig.align='center', out.width='50%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_me2Power.png')
```

$f$ is equal to 0.27. To convert to $\eta^2$, use the following equation:

$$\eta^2 = \frac{f^2}{1+f^2} = \frac{.07}{1+.07} = .07$$

For the main effect of `Condition`, if you had 150 participants, the minimum effect you would be able to detect with 80% power and $\alpha$ = .05 is $\eta^2$ = .07, which equates to a moderate effect. If the true effect of `Time` on RCDS score is smaller than .07, your power level would be less than 80%.

</details>
</div>

## Data Review

Before running any analyses, you should first check your data. In many cases, some kind of cleaning or data wrangling will be necessary. For instance, are there any missing values? Do you have any unexpected values or extreme outliers? Do you need to create a variable from the existing data (e.g., a summary metric for a cognitive task)? These things should be dealt with before conducting the analyses.

Additionally, you'll need to compute descriptive data. You'll do this for both your main variables of interest and your sample's demographic data, as this must be included in the Sample portion of your Methods section. 

### Your Tasks

+ [ ] $\ $ Open 'Week5LabData.sav'

+ [ ] $\ $ Check whether all variables imported into SPSS as the correct measurement type. 

+ [ ] $\ $ Add labels to `Condition`: 0 = 'Waitlist'; 1 = 'Play Therapy; 2 = 'Pet Therapy'

+ [ ] $\ $ Check the descriptive statistics of your data.

+ [ ] $\ $ Produce the proper plot to visualise the distribution of your continuous variables, `Age`, `Time1`, and `Time2`.


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

For continuous variables, the descriptive statistics you'll want to check are mean and standard deviation. It's also useful to check the minimum and maximum so you can easily identify values outside of your expected range. For categorical variables, you'll check the frequency of participants in each group.

</details>
</div>
</br>

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

<span style = "font-weight: bold; font-size: 14pt"> Adjust Variable Measure Format </span>

To check that your variables are labeled as the correct scale of measurement, look at the **Measure** column under the *Variable View* tab.

* `Age` - Scale

* `Gender` - Nominal

* `Condition` - Nominal

* `Time1` - Scale

* `Time2` - Scale

In this instance, SPSS assigned `Age` as Nominal, so it should be corrected.

<br>

<span style = "font-weight: bold; font-size: 14pt"> Add Labels to `Condition` </span>

To associate a label with each value of a variable, you'll use the **Values** column under the **Variable View** tab.

Select the Condition x Values cell and click the dots to bring up the _Value Labels_ box. Use the $+$ to add a new label. In the Value column, type 0, then in the Label column, type 'Waitlist'. Repeat the process for the Play and Pet Therapy groups: 

```{r, echo = F, fig.align= 'center', out.width = '50%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_conditionLabels.png')
```

<br>

<span style = "font-weight: bold; font-size: 14pt"> Check Descriptive Statistics & Produce Distribution Plots </span>

**Categorical Variables:** The categorical variables are `Condition` and `Gender`. Click *Analyze>Descriptive Statistics>Frequencies*, then add these two variables to the 'Variable(s)' box. Make sure 'Display frequency tables' is checked, then click 'OK'. You should see the following output:

```{r, echo = F, fig.align= 'center', out.width = '50%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_freqTables.png')
```

Note that if you set up the labels for `Condition` properly, these will appear in the frequency tables, rather than the numeric values you see in 'Data View'. 

According to the output, there are no missing datapoints on either of these variables and both `Gender` and `Condition` are distributed equally.

**Continuous Variables:** The continuous variables are `Age`, `Time1`, and `Time2`. Click *Analyze>Descriptive Statistics>Frequencies*, then add these variables to the 'Variable(s)' box. Make sure 'Display frequency tables' is not ticked, then click 'Statistics'. Tick 'Mean', 'Std. Deviation', 'Minimum', and 'Maximum'. Click 'Continue', then click 'Charts'. As these are continuous variables, they should be visualised using histograms. Click 'Histogram', then tick 'Show normal curve on histogram'. Click 'Continue' and then 'OK'. 

```{r, echo = F, fig.align= 'center', out.width = '40%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_descriptives.png')
```

Have a look at the continuous variables' distributions. There are no concerning outliers or unusual values. `Age` isn't normally distributed, but as its not one of the variables being tested, this doesn't matter. In fact, a uniform age distribution indicates there is a good range of participants across ages in your sample.

```{r, echo = F, fig.align= 'center', out.width = '50%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_ageHist.png')
```

```{r, echo = F, fig.align= 'center', out.width = '50%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_t1Hist.png')
```

```{r, echo = F, fig.align= 'center', out.width = '50%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_t2Hist.png')
```


</details>
</div>
</br>

## Check Assumptions

The assumptions of a Factorial ANOVA are:

(1) **Normality:** Residuals are normally distributed

(2) **Independence of Observations:** Individual observations should not be dependent upon any others

(3) **Homogeneity of Variance:** Variances within each group should be generally similar


### Your Tasks

+ [ ] $\ $ Decide whether your data meet the assumption of normality

+ [ ] $\ $ Decide whether your data meet the assumption of independence

+ [ ] $\ $ Decide whether your data meet the assumption of homogeneity


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Have a look at the [lecture slides](https://mtruelovehill.github.io/ISAP/Lectures/Week05_ANOVAII_lecture.html) if you're lost.

You'll need to run the ANOVA in order to test the assumptions of normality and homogeneity. As you need to test normality and homogeneity using the residuals, you'll need to click the 'Save' button to produce both *Standardised Residuals* and *Predicted Values* when the test is run. 

</details>
</div>
</br>

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

To check the assumptions of normality and homogeneity, residuals and predicted values will need to be produced by running the ANOVA. See the Solution tab in [Primary Analysis] if you need a step-by-step guide on setting up the test. Once the test is set up, click the 'Save' option, and tick 'Unstandardized' in the Predicted Values box and 'Standardized' in the Residuals box.

```{r, echo = F, fig.align= 'center', out.width='50%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_saveOption.png')
```

```{r, echo = F, fig.align= 'center', out.width='50%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_saveVariables.png')
```

Click 'Continue', then 'Options'. Tick the box next to 'Homogeneity tests' to run Levene's test. Click 'Continue' then 'OK'. 

This process will produce four new columns that reflect the residuals from the model (2 predicted value columns, `PRE_1` and `PRE_2` and 2 standardised residual columns, `ZRE_1` and `ZRE_2`), as well as output the results from Levene's test (and Mauchly's test when relevant). 

<br>

<span style = "font-weight: bold; font-size: 14pt"> Normality </span>

To check normality, you'll produce histograms and Q-Q plots using the two new residual columns you created. Navigate to *Analyze>Descriptive Statistics>Frequencies* and add the two residual columns to the 'Variable(s)' box. Click 'Charts', then 'Histograms' and tick 'Show normal curve on histogram'. Click 'Continue' and 'OK'. 

```{r, echo = F, fig.align= 'center', out.width='50%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_histRes1.png')
```

```{r, echo = F, fig.align= 'center', out.width='50%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_histRes2.png')
```

These look normal. There's a slight point in the upper tail of the Time1 residuals that doesn't perfectly follow the normal curve, but it's not problematic. The Q-Q plots can also be checked. Navigate to *Analyze>Descriptive Statistics>Q-Q Plots* and add the two residual columns to the 'Variable(s)' box. Click 'OK'. 

```{r, echo = F, fig.align= 'center', out.width='50%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/week6_qqRes1.png')
```

```{r, echo = F, fig.align= 'center', out.width='50%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/week6_qqRes2.png')
```

The Q-Q plots show no major violations of normality, so the assumption of normality can be considered to be met.

<span style = "font-weight: bold; font-size: 14pt"> Homogeneity of Variance </span>

To check the homogeneity assumption, plot the corresponding residual and predicted value columns. Navigate to *Graphs>Scatter/Dot*, select 'Simple Scatter', and then 'Define'. Place the first Residuals column (`ZRE_1`) on the y-axis and the first Predicted Values (`PRE_1`) column on the x-axis, then click OK. 

In order for homogeneity to be assumed, the points should be distributed generally consistently above and below the residual value of 0. One line of points shouldn't be substantially longer or shorter than the others. The distribution of points on this plot looks generally homogeneous:

```{r, echo = F, fig.align= 'center', out.width='50%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/anovaII_resVpred1.png')
```

Repeat the process with `ZRE_2` and `PRE_2`:

```{r, echo = F, fig.align= 'center', out.width='50%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/anovaII_resVpred2.png')
```

Again, the points look generally homogeneous between levels, so the assumption of homogeneity of variance can be considered to be met.

You can support this decision by interpreting the results of Levene's test in your output:

```{r, echo = F, fig.align= 'center', out.width='50%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_levenesTest.png')
```

Check the two rows that say 'Based on Mean'. All $p$-values are greater than the $\alpha$ threshold of .05, so the tests are not significant. This further supports your decision that the assumption of homogeneity of variance is met.

<span style = "font-weight: bold; font-size: 14pt"> Independence </span>

Assessing independence requires you to have an understanding of the conditions under which your data were collected. Between-subjects study designs increase the likelihood that the observations are independent of each other. Additionally, using an appropriate analysis for within-subjects variables (such as a repeated-measures ANOVA) ensures you're accounting for within-subjects variance, so you can consider this assumption to be met.

</details>
</div>

## Primary Analysis

As you are testing the effect of two independent variables on a dependent variable, you'll use results from a Factorial ANOVA with one between-subjects variable (`Condition`) and one within-subjects variable (Time: `Time1` and `Time2`) to provide statistical support for your hypotheses. Recall that you're testing the following effects:

**Main Effect 1**: $H_1: \mu_{waitlist} \neq \mu_{PlayTherapy} \neq \mu_{PetTherapy}$

**Main Effect 2**: $H_1: \mu_{T1} \neq \mu_{T2}$

**Interaction Effect**: $H_1: C \neq 0$

$C = (\mu_{T1}\times\mu_{waitlist}-\mu_{T1}\times\mu_{PlayTherapy}-\mu_{T1}\times\mu_{PetTherapy} )-(\mu_{T2}\times\mu_{waitlist}-\mu_{T2}\times\mu_{PlayTherapy}-\mu_{T2}\times\mu_{PetTherapy})$


### Your Tasks

+ [ ] $\ $ Run a Factorial ANOVA to test your hypotheses and interpret the results with $\alpha$ = .05.

+ [ ] $\ $ Compute the effect sizes associated with your analysis

```{r cyrFacAOV, echo = FALSE}
quiz(caption = 'Check Your Results',
     question_numeric("What is the F-statistic associated with main effect 1 (Condition)? Please round your answer to two decimal places.",
              answer(2.15, correct = T),
              message = "The F-statistic associated with this test is 2.15. You'll find this in the 'Tests of Between-Subjects Effects' table."),
     question("Is the effect of Time (main effect 2) significant?",
              answer('Yes'),
              answer('No', correct = T),
              message = "The p-value associated with Time can be found in the 'Tests of Within-Subjects Effects' table. It is .153, which is larger than the alpha threshold of .05, indicating the effect of Time is not significant."),
     question_numeric("What is the effect size (partial eta-squared) associated with the interaction effect (Condition x Time)? Please round your answer to two decimal places.",
              answer(0.07, correct = T),
              message = "The effect size associated with the interaction effect is 0.07. You'll find this in the 'Tests of Within-Subjects Effects' table."))
```

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

To run a Factorial ANOVA with a within-subjects variable, you should navigate to *Analyze>General Linear Model>Repeated Measures*. When working with only between-subjects variables, you would navigate to *Analyze>General Linear Model>Univariate*.

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Navigate to *Analyze>General Linear Model> Repeated Measures*. Your repeated measure variable is time, and there are two levels (`Time1` and `Time1`) so set it up accordingly.  Add the name of your measure (RCDS) if you'd like.

```{r, echo = F, fig.align= 'center', out.width = '50%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_RMvariables.png')
```

Click 'Define', then add your Within-Subjects Variables, `Time1` and `Time2`, and your Between-Subjects Variable, `Condition`. 

Now that you've added your variables, you can set up some other options for your analysis. In order to help you visualise your results, it's helpful to look at a plot. Click 'Plots', then add `Time` to the 'Horizontal Axis' box (this sets the x-axis of your plot), and `Condition` to the 'Separate Lines' box. Click 'Add', and the plot will appear in the 'Plots:' box below. Make sure 'Line Chart' is selected and the 'Include Error Bars' box is ticked. I also like to tick 'Include reference line for grand mean', so that the mean of the dependent variable across all groups is shown. 

```{r, echo = F, fig.align= 'center', out.width = '50%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_intPlotOptions.png')
```

Click 'Continue', then click the 'EM Means' button to set up the simple effects analysis so that the interaction can be more easily interpreted. Add the interaction term ('Condition*time') to the 'Display Means For:' box, then tick 'Compare simple main effects'. To avoid Type I error inflation, you can use the confidence interval adjustment option. I default to 'Bonferroni'. It's more conservative (slightly higher chance of Type II error), but it also doesn't have the assumptions of Sidak, so it can be used more generally.

```{r, echo = F, fig.align= 'center', out.width = '50%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_EMM.png')
```

Click 'Continue'. If you haven't already, you'll need to produce the residuals from your model so that you can check normality. Click 'Save', then tick the Residuals box beside 'Standardized'. See [Check Assumptions] for more information.

Finally, click 'Options', and select 'Descriptive Statistics' and 'Estimates of Effect Size'. Click 'Continue' and then 'OK' to run your model.

There's a lot of output to review (some of which you can ignore). 

The Descriptive Statistics box provides the mean, $SD$, and $n$ for each possible combination of variables:

```{r, echo = F, fig.align= 'center', out.width = '75%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_groupDesc.png')
```

You can ignore the multivariate tests table. You can also skip Mauchly's test. Because you only have 2-levels of your within-subjects variable (`time`), sphericity is assumed. Sphericity only needs to be tested when you have 3 or more levels.

Have a look at the 'Tests of Within-Subjects Effects' table. Here, you can review the main effect of `time`, as well as the interaction between `time` and `Condition`. You can interpret the 'Sphericity Assumed' rows, since that assumption has been met. 

```{r, echo = F, fig.align= 'center', out.width = '75%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_wsEffects.png')
```

The main effect of `time` is not significant, as the $p$-value associated with this test (.076) is greater than our $\alpha$ threshold of .05. However, the interaction between `Time` and `Condition` is significant.

To check the main effect of `Condition`, have a look at the 'Tests of Between-Subjects Effects' table:

```{r, echo = F, fig.align= 'center', out.width = '75%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_bsEffects.png')
```

As with `time`, the effect of `Condition` alone not significant ($p$ = .120). 

<br>

To better understand the interaction, have a look at the Estimated Marginal Means Tables; first, have a look at the results under '1. Condition * time' section.

The 'Estimates' table gives similar information to the previously-discussed 'Descriptive Statistics' table, but the 'Pairwise Comparisons' and 'Univariate Tests' table provide more information.

```{r, echo = F, fig.align= 'center', out.width = '75%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_pwComp.png')
```

The 'Pairwise Comparisons' table shows you the difference in RCDS scores between `Conditions` at each level of `time`. Specifically, at time 1, RCDS scores from participants on the waitlist were only 1.72 points higher than those in the Play Therapy group and 1 point higher than those in the Pet Therapy group. This difference was not significant ($p$ ~ 1.00 in both cases). Additionally, participants in the Pet Therapy group had RCDS scores 0.72 points lower than those in the Play therapy group at time, a difference which also was not significant. Because the differences were not significant, we would report that there were no differences in RCDS scores between Conditions at time 1. 

However, at Time 2, the mean RCDS score in the Play Therapy group was 10.00 points lower than the mean RCDS score in the waitlist group; this difference was significant ($p$ = .023). Additionally, the mean RCDS score in the Pet Therapy group was 11.12 points lower than the mean RCDS score in the waitlist group; this difference was also significant ($p$ = .009). Participants in the Pet Therapy group scored 1.12 points lower than participants in the Play Therapy group at time 2, but as this difference was not significant ($p$ ~ 1.00), we would say that there is no difference between the two groups at time 2.

The general results at each time point are given in the 'Univariate Tests` box:

```{r, echo = F, fig.align= 'center', out.width = '75%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_univariateResults1.png')
```

The effect of `Condition` at time 1 is not significant, which aligns with the results in the pairwise comparisons table (none of the groups were significantly different from each other at time 1). However, there is a significant difference between groups at time 2, which once again aligns with the results in the pairwise comparisons table (Play Therapy and Pet Therapy led to significantly lower RCDS scores than being on the waitlist).

Although it seems as though pet therapy and play therapy led to better outcomes than the waitlist, it's still important to determine whether they led to significant change from baseline. To investigate this further, examine the '2. Condition * time' section:


```{r, echo = F, fig.align= 'center', out.width = '75%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_pwComp2.png')
```

In both the waitlist ($p$ = .078) and play therapy ($p$ = .084) conditions, there was no significant change from timepoint 1 to timepoint 2. This suggests that these two conditions did not significantly impact depression symptoms over time. However, there was a significant difference in RCDS scores from time 1 and time 2 for participants in the pet therapy condition, $p$ = .013. Scores decreased by 5.94 points after treatment, suggesting that pet therapy was effective in relieving symptoms of depression in hospitalised children.

The general results can be examined in the 'Univariate Tests` box:

```{r, echo = F, fig.align= 'center', out.width = '75%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_univariateResults2.png')
```



Finally, full interaction results can be visualised with the 'Profile Plots' output:

```{r, echo = F, fig.align= 'center', out.width = '75%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_interactionPlot.png')
```


</details>
</div>
</br>

## Interpret & Report 

Now that you've completed the analyses, write a mini results section describing your findings. In this section, please:

+ Give a brief description of your sample as you would in a methods section. 

+ Report your results and a provide interpretation in APA style. 


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

There are many ways you could write this up, but you'll need to at least include the following information:

+ alpha level
+ power analysis information (including effect size, sample size, power, and alpha)
+ number of participants (n)
+ participant demographics (mean age, age sd, and age range of sample; gender distribution of sample)
+ results from assumptions checks
+ descriptive data for each IV group (M and SD)
+ the type of test used
+ power analysis results
+ independent and dependent variables tested
+ type of independent variables (between- or within-subjects)
+ $F$-statistic
+ degrees of freedom
+ p-values
+ effect sizes
+ results from simple effects analysis (if interaction is significant)

When reporting a factorial ANOVA, you should specify the ANOVA as a JxK [Between/Within/Mixed] Factorial ANOVA, where J reflects the number of levels in your first independent variable, and K reflects the number of variables in your second independent variable.

Remember that the proper style of reporting the results from an ANOVA looks like this:

$F$([between groups $df$], [within groups $df$]) = [$F$-statistic], $p$ = [$p$-value], $\eta^2$ = [$\eta^2$ value].

Note that the numbers inside the curly brackets refer to the degrees of freedom. ANOVA has two types of $df$ that should be reported. Please refer to the [lecture slides](https://mtruelovehill.github.io/ISAP/Lectures/Week05_ANOVAII_lecture.html) for a specific example.

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

In this study, we tested the effect of therapy method on the treatment of depression symptoms in hospitalised children. We split participants into three groups: waitlist, play therapy, and pet therapy. We measured depression symptoms using RCDS scores at baseline, and again after treatment. We hypothesised that there would be a difference in RCDS scores across therapy condition, and that this difference would be dependent upon time. To test this, we performed a 2x3 Mixed Factorial ANOVA with both one within-subjects variable, Time (levels: time 1; time 2), and one between-subjects variable, therapy group (levels: Waitlist; Play Therapy; Pet Therapy) as independent variables and RCDS score as the dependent variable. $\alpha$ was set at .05 for all analyses. An a priori power analysis indicated that 150 participants were sufficient to detect a moderate interaction effect ($\eta^2$ = .06) using a 2x3 mixed factorial ANOVA with 80% power and $\alpha$ = .05.

Our original sample consisted of 150 participants between the ages of 5 and 14 ($M$ = 9.15, $SD$ = 2.66; 75 females, 75 males). The normality assumption was checked through visual assessment of the QQ-plots and histograms. The homogeneity of variance assumption was checked through visual assessment of a residuals versus predicted values plot and confirmed with Levene's test. The data met all assumptions.

The effect of Therapy Group on RCDS score was not significant, $F$(2, 147) = 2.15, $p$ = .120, $\eta^2$ = .03. Additionally, the effect of Time on RCDS scores was not significant, $F$(1, 147) = 2.06, $p$ = .153, $\eta^2$ = .01. 

There was a significant interaction between Time and Therapy Group on RCDS score, $F$(2, 147) = 5.24, $p$ = .006, $\eta^2$ = .07. Simple effects analyses were used to probe the interaction. These indicated that while there was no significant effect of Therapy Group at baseline, $F$(2, 147) = 0.11, $p$ = .898, there was a significant difference between therapy groups at follow-up, $F$(2, 147) = 5.47, $p$ = .005, $\eta^2_p$ = .07. Specifically, those in the waitlist group had significantly higher RCDS scores than those in the Play Therapy ($p$ = .023), and Pet Therapy groups ($p$ = .009). There was no significant difference between the Pet and Play Therapy groups, $p$ ~ 1. 

Simple effects analyses also indicated that Pet Therapy significantly improved RCDS scores, $F$(1, 147) = 6.36, $p$ = .013, $\eta^2_p$ = .04. However, participants in the Play Therapy, $F$(1, 147) = 3.03, $p$ = .084, $\eta^2_p$ = .02, and waitlist groups, $F$(1, 147) = 3.15, $p$ = .078, $\eta^2_p$ = .02, saw no significant improvement over time.

This suggests that Pet Therapy is an effect method for treating depression symptoms in hospitalised children.

See Table 1 for descriptive data for each group.

```{r, echo = F, fig.align='center', out.width='50%'}
knitr::include_graphics('https://mtruelovehill.github.io/ISAP/Labs/images/week5_descTable.png')
```


<br>
<br>

You can also put results from ANOVA tests into a table. See [here](https://apastyle.apa.org/style-grammar-guidelines/tables-figures/sample-tables#anova) for an example of an APA-style ANOVA table. Note that the degrees of freedom may not be appropriate to include in the column head if it changes across variables.

</details>
</div>
</br>